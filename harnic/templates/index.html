<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
  <title>Harnic</title>
</head>
<body>
<style type="text/css">
    /* Some basic formatting */
    @media only screen and (min-width: 1900px) {
      .ui.container {
        width: 1720px;
      }

      .ui.grid.container {
        width: calc( 1720px  +  2rem ) !important;
      }

      .ui.relaxed.grid.container {
        width: calc( 1720px  +  3rem ) !important;
      }

      .ui.very.relaxed.grid.container {
        width: calc( 1720px  +  5rem ) !important;
      }
    }

    .container {
        padding: 3em 0em;
    }

    .ui.dividing.header,
    .first {
        margin-top: 3em;
    }

    h1,
    h3 {
        margin-top: 10em;
    }

    .entry-info .key{
        width: 20% !important;
        font-weight: bold !important;
    }

    .entry-detailed-info .insert{
        color: green !important;
    }

    .entry-detailed-info .delete{
        color: red !important;
    }

    .entry-detailed-info .modified{
        color: orange !important;
    }
</style>
<div class="ui container">
  <h1 class="ui dividing header">Harnic</h1>
  <table class="ui fixed celled selectable accordion table">
    <thead>
    <tr>
      <th>{{hars[0].path}}</th>
      <th>{{hars[1].path}}</th>
    </tr>
    </thead>
    <tbody>
    {% for diff_record in records %}
      {% set cell_class = {'delete': 'negative', 'insert': 'positive', 'diff': 'warning', 'equal': ''} %}
      <tr class="{{cell_class[diff_record.tag.value]}} title">
        {% set r1 = diff_record.pair[0] %}
        {% set r2 = diff_record.pair[1] %}
        <td>
          {% if r1 %}
            <div class="ui basic mini label">{{r1.request['method']}}</div>
            {{r1.request['url']}}
          {% endif %}
        </td>
        <td>
          {% if r2 %}
            <div class="ui basic mini label">{{r2.request['method']}}</div>
            {{r2.request['url']}}
          {% endif %}
        </td>
      </tr>
      <div class="content">
        <tr>
          {% if diff_record.tag.value in ['insert', 'delete', 'equal'] %}
            {% if diff_record.tag.value == 'insert' %}
              {% set r = r2 %}
            {% endif %}
            {% if diff_record.tag.value == 'delete' %}
              {% set r = r1 %}
            {% endif %}
            {% if diff_record.tag.value == 'equal' %}
              {% set r = r1 %}
            {% endif %}
            <td colspan="2" class="transition hidden">
              <div class="ui top attached tabular menu">
                <a class="item active" data-tab="request">Request</a>
                <a class="item" data-tab="response">Response</a>
                <a class="item" data-tab="raw-data">Raw Data</a>
              </div>
              <div class="ui bottom attached tab segment active" data-tab="request">
                <div class="ui list">
                  <div class="item">
                    <div><b>Started:</b> {{r.request['_ts'] | ctime}}</div>
                  </div>
                  <div class="item">
                    <div><b>Method:</b> {{r.request['method']}}</div>
                  </div>
                  <div class="item">
                    <div><b>Body size:</b> {{r.request['bodySize']}}</div>
                  </div>
                  <div>
                    <div><b>Query params:</b></div>
                    <div class="list">
                      {% for key, values in r.request['url'].query_params.items() %}
                        <div class="item"><b>{{key}}</b>: {{values|join(', ')}}</div>
                      {% endfor %}
                    </div>
                  </div>
                  <div>
                    <div><b>Headers:</b></div>
                    <div class="list">
                      {% for key, values in r.request['headers'].items() %}
                        <div class="item"><b>{{key}}</b>: {{values|join(', ')}}</div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="ui bottom attached tab segment" data-tab="response">
                <div class="ui list">
                  <div class="item">
                    <div><b>Recieved:</b> {{r.response['_ts'] | ctime}}</div>
                  </div>
                  <div class="item">
                    <div><b>Status:</b> {{r.response['status']}}</div>
                  </div>
                  <div class="item">
                    <div><b>Headers:</b></div>
                    <div class="list">
                      {% for key, values in r.response['headers'].items() %}
                        <div class="item"><b>{{key}}</b>: {{values|join(', ')}}</div>
                      {% endfor %}
                    </div>
                  </div>
                  <div class="item">
                    <div><b>Headers:</b></div>
                    <div class="list">
                      {% for key, value in r.response['content'].items() %}
                        <div class="item"><b>{{key}}</b>: {{value}}</div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="ui bottom attached tab segment" data-tab="raw-data">
                Raw data
              </div>
            </td>
          {% elif diff_record.tag.value == 'diff' %}
            <td colspan="1" class="transition hidden">
              <div class="ui top attached tabular menu">
                <a class="item active" data-tab="request">Request</a>
                <a class="item" data-tab="response">Response</a>
                <a class="item" data-tab="raw-data">Raw Data</a>
              </div>
              <div class="ui bottom attached tab segment active entry-detailed-info" data-tab="request">
                <div class="ui list">
                  <div class="item">
                    <div><b>Started:</b> {{r1.request['_ts'] | ctime}}</div>
                  </div>
                  <div class="item">
                    <div><b>Method:</b> {{r1.request['method']}}</div>
                  </div>
                  <div class="item">
                    <div><b>Body size:</b> {{r1.request['bodySize']}}</div>
                  </div>
                  <div class="item">
                    <div><b>Query params:</b></div>
                    <div class="list">
                      {% for key, values in r1.request['url'].query_params.items() %}
                        <div class="item"><b>{{key}}</b>: {{values|join(', ')}}</div>
                      {% endfor %}
                    </div>
                  </div>
                  <div class="item">
                    <div><b>Headers:</b></div>
                    <div class="list">
                      {% for key, values in r1.request['headers'].items() %}
                        <div class="item"><b>{{key}}</b>: {{values|join(', ')}}</div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="ui bottom attached tab segment entry-detailed-info" data-tab="response">
                <div class="ui list">
                  <div class="item">
                    <div><b>Recieved:</b> {{r1.response['_ts'] | ctime}}</div>
                  </div>
                  <div class="item">
                    <div><b>Status:</b> {{r1.response['status']}}</div>
                  </div>
                  <div class="item">
                    <div><b>Headers:</b></div>
                    <div class="list">
                      {% for key, values in r1.response['headers'].items() %}
                        <div class="item"><b>{{key}}</b>: {{values|join(', ')}}</div>
                      {% endfor %}
                    </div>
                  </div>
                  <div class="item">
                    <div><b>Content:</b></div>
                    <div class="list">
                      {% for key, value in r1.response['content'].items() %}
                        <div class="item"><b>{{key}}</b>: {{value}}</div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="ui bottom attached tab segment" data-tab="raw-data">
                Raw data
              </div>
            </td>
            <td colspan="1" class="transition hidden">
              <div class="ui top attached tabular menu">
                <a class="item active" data-tab="request">Request</a>
                <a class="item" data-tab="response">Response</a>
                <a class="item" data-tab="raw-data">Raw Data</a>
              </div>
              <div class="ui bottom attached tab segment active entry-detailed-info" data-tab="request">
                <div class="ui list">
                  <div class="item">
                    <div><b>Started:</b> {{r2.request['_ts'] | ctime}}</div>
                  </div>
                  <div class="item">
                    <div><b>Method:</b> {{r2.request['method']}}</div>
                  </div>
                  {% if not diff_record.diff.fields['request']['bodySize'].equal %}
                    {% set span_class = 'modified' %}
                  {% endif %}
                  <div class="item {{span_class}}">
                    <div><b>Body size:</b> {{r2.request['bodySize']}}</div>
                  </div>
                  <div class="item">
                    <div><b>Query params:</b></div>
                    <div class="list">
                      {% for key, values in r2.request['url'].query_params.items() %}
                        {% if key in diff_record.diff.fields['request']['query_params'].diff.added %}
                          {% set span_class = 'insert' %}
                        {% elif key in diff_record.diff.fields['request']['query_params'].diff.modified.keys() %}
                          {% set span_class = 'modified' %}
                        {% endif %}
                        <div class="item {{span_class}}"><b>{{key}}</b>: {{values|join(', ')}}</div>
                      {% endfor %}
                      {% for key, values in r1.request['url'].query_params.items() %}
                        {% if key in diff_record.diff.fields['request']['query_params'].diff.removed and key not in r2.request['query_params'].keys() %}
                          {% set span_class = 'delete' %}
                          <div class="item {{span_class}}"><b>{{key}}</b>: {{values|join(', ')}}</div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                  <div class="item">
                    <div><b>Headers:</b></div>
                    <div class="list">
                      {% for key, values in r2.request['headers'].items() %}
                        {% if key in diff_record.diff.fields['request']['headers'].diff.added %}
                          {% set span_class = 'insert' %}
                        {% elif key in diff_record.diff.fields['request']['headers'].diff.modified.keys() %}
                          {% set span_class = 'modified' %}
                        {% endif %}
                        <div class="item {{span_class}}"><b>{{key}}:</b> {{values|join(', ')}}</div>
                      {% endfor %}
                      {% for key, values in r1.request['headers'].items() %}
                        {% if key in diff_record.diff.fields['request']['headers'].diff.removed and key not in r2.request['headers'].keys() %}
                          {% set span_class = 'delete' %}
                          <div class="item {{span_class}}"><b>{{key}}:</b> {{values|join(', ')}}</div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
                </div>
              <div class="ui bottom attached tab segment entry-detailed-info" data-tab="response">
                <div class="ui list">
                  <div class="item">
                    <div><b>Recieved:</b> {{r2.response['_ts'] | ctime}}</div>
                  </div>
                  {% if not diff_record.diff.fields['response']['status'].equal %}
                    {% set span_class = 'modified' %}
                  {% endif %}
                  <div class="item {{span_class}}">
                    <div><b>Status:</b> {{r2.response['status']}}</div>
                  </div>
                  <div class="item">
                    <div><b>Headers:</b></div>
                    <div class="list">
                      {% for key, values in r2.response['headers'].items() %}
                        {% if key in diff_record.diff.fields['response']['headers'].diff.added %}
                          {% set span_class = 'insert' %}
                        {% elif key in diff_record.diff.fields['response']['headers'].diff.modified.keys() %}
                          {% set span_class = 'modified' %}
                        {% endif %}
                        <div class="item {{span_class}}"><b>{{key}}:</b> {{values|join(', ')}}</div>
                      {% endfor %}
                      {% for key, values in r1.response['headers'].items() %}
                        {% if key in diff_record.diff.fields['response']['headers'].diff.removed and key not in r2.response['headers'].keys() %}
                          {% set span_class = 'delete' %}
                          <div class="item {{span_class}}"><b>{{key}}:</b> {{values|join(', ')}}</div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                  <div class="item">
                    <div><b>Content:</b></div>
                    <div class="list">
                      {% for key, value in r2.response['content'].items() %}
                        {% if key in diff_record.diff.fields['response']['content'].diff.added %}
                          {% set span_class = 'insert' %}
                        {% elif key in diff_record.diff.fields['response']['content'].diff.modified.keys() %}
                          {% set span_class = 'modified' %}
                        {% endif %}
                        <div class="item {{span_class}}"><b>{{key}}:</b> {{value}}</div>
                      {% endfor %}
                      {% for key, value in r1.response['content'].items() %}
                        {% if key in diff_record.diff.fields['response']['content'].diff.removed and key not in r2.response['content'].keys() %}
                          {% set span_class = 'delete' %}
                          <div class="item {{span_class}}"><b>{{key}}:</b> {{value}}</div>
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="ui bottom attached tab segment" data-tab="raw-data">
                Raw data
              </div>
            </td>
          {% endif %}
        </tr>
      </div>
    {% endfor %}
    </tbody>
  </table>
</div>
<script>
  $('.ui.accordion')
    .accordion({
      exclusive: false
    })
  ;
  $('.menu .item').tab();
</script>
</body>
</html>